rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 公開讀取商品（任何人都可以瀏覽商品）
    match /products/{productId} {
      // 允許任何人讀取商品資料
      allow read: if true;

      // 只有經過驗證的用戶可以寫入（透過 Admin SDK）
      allow write: if request.auth != null;
    }

    // 會員資料需要身份驗證
    match /members/{memberId} {
      // 只有經過驗證的用戶才能讀寫會員資料
      allow read, write: if request.auth != null;

      // 可選：限制用戶只能讀取自己的資料
      // allow read, write: if request.auth != null && request.auth.uid == memberId;
    }

    // 訂單資料需要身份驗證
    match /orders/{orderId} {
      // 只有經過驗證的用戶才能讀寫訂單資料
      allow read, write: if request.auth != null;

      // 可選：限制用戶只能讀取自己的訂單
      // allow read: if request.auth != null &&
      //             request.auth.uid == resource.data.memberId;
      // allow create: if request.auth != null &&
      //               request.auth.uid == request.resource.data.memberId;
      // allow update, delete: if request.auth != null &&
      //                       request.auth.uid == resource.data.memberId;
    }

    // 預設規則：拒絕所有其他存取
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
